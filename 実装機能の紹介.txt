
本システムは、GPT生成、VOICEVOX音声合成、OBS制御、UI操作、ファイル信号管理を統合し、
リアルタイムに対話・演出を生成する総合AI制御システムです。

各モジュールが独立しながらも信号ファイルにより統合され、
“AIキャラクターが自律的に会話・発話・演出を行う対話型メディア環境”として動作します。

【全体構造】

● UI画面（ui_runner）CustomTkinter
・テキスト入力欄（WAIT_TEXT保護）
・テーマ変更ボタン、ループ停止
・sub1〜sub5、エンディング起動ボタン
・設定1〜4起動ボタン
・JSONファイル選択 → selected_file_path.txt に書き込み

<img src="../スクリプト画像/メインシステムUI画像.png" width="800"
     style="display:block; margin:20px auto;">


● 設定1（config1）
・キャラの声質・話速・ピッチ・抑揚・音量・発声長設定。
・試聴 → 保存 → 反映まで一括。

<img src="../スクリプト画像/メインシステム設定１画像.png" width="800"
     style="display:block; margin:20px auto;">


● 設定2（config2）
・音声保存ON/OFF、文章保存ON/OFF、感情ID判定、Emotion OBS切替。
・主要フォルダの即時オープン。

● 設定3（config3）
・OpenAIモデル設定、APIキー、OBS構成ファイル管理。

● 設定4（config4）
・設定JSON、ログ、信号ファイルをワンクリックで開ける保守ハブ。

【バックエンド構成】

■ メイン制御（main_control）
・ end_signal / sub_signal / theme_signal / ending_signal を常時監視
・ サブループ起動・停止制御
・ shared_time.txt に現在時刻を出力
・ テーマ更新時は shared_theme.txt を更新
・ ループ停止時は信号ファイルを完全クリーンアップ
・ obs_save.json を基にOBS状態を自動復元

■ メインループ（main_loop）
・ GPT会話生成、VOICEVOX合成、OBS制御の中枢
・ キャラ人格設定
・ テーマ処理、emotion解析、OBS表示更新

■ サブループ（sub2〜sub5）
・全サブループが並列動作し、入力モードごとに処理を担当。

【モード】
1：文章読み上げモード
2：台本読み上げモード
3：監視読み上げモード
4：音声入力読み上げモード

【共通機能】
・ GPT感情スタイル解析
・ Emotion OBSソース切替
・ VOICEVOX合成・高速ストリーミング再生
・ OBSトークソース ON/OFF
・ 音声・文章の連番保存
・ 文を句読点分割 → 逐次合成 → 再生

【エンディング制御（ending_loop）】
・ ending_save.json から話者・選択文をロード
・ OBSを end_scene に切替
・ エンディング演出ソースON
・ VOICEVOXでナレーション合成
・ 再生後、信号ファイルをリセットし停止状態へ

【OBS完全連携】
・ シーン切替
・ キャラ背景ON/OFF
・ トーク時の口パクON/OFF
・ テキストソース更新
・ Emotion OBSの表情制御
・ OBS設定ファイルの復元

【VOICEVOX統合】
・ audio_query → synthesis の高速処理
・ 文分割ストリーミング合成
・ speaker_id / speedScale / pitchScale / emotionID を動的設定
・ 未接続時は安全フォールバック
・ latency_log.txt へ 合成/再生/保存 の速度記録

【GPT制御】
・ gpt-4o-mini による応答生成
・ キャラ人格設定
・ 感情分析（キャラID自動切り換え ずんだもん・めたん専用）
・ 感情分析 Emotion OBSと連携して表情自動切り換え
・ ランダム制御で演出多様化

【信号ファイル制御】
・theme_signal.txt：テーマ変更
・sub_signal.txt：sub1〜sub5 呼び出し
・end_signal.txt：サブループ停止
・ending_signal.txt：エンディング発火
・shared_theme.txt：テーマ共有
・shared_time.txt：時刻共有

【保存機能】
キャラ別に連番保存。設定2でON/OFF可能。
・ 音声（WAV）
・ 文章（TXT）

【ログ・デバッグ】
・latency_log.txt：処理速度
・time_debug.txt：タイムスタンプ
・shared_time/theme：共有情報
・config4_ui：ログ・信号にフルアクセス

【設計思想】
・GPT：会話生成  
・VOICEVOX：音声合成  
・OBS：映像出力  
・UI：操作  
・信号：全体同期

責務分離により  
・ 指示反映の高速化  
・ 音声/映像/感情/ログの一元管理  
・ 手動操作の極小化  
・ 自動制御に特化した配信システム化