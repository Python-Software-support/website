
■ 1. 基本設定

・ChromaDB の保存ディレクトリ（DB_DIR）を指定

・OpenAI API キーを環境変数から読み込み

・コード記憶用コレクション「code_memory」をロード


■ 2. 質問の埋め込み生成

・OpenAIEmbeddingFunction を使用して query をベクトル化

・text-embedding-3-large を用いて高品質な埋め込みを作成


■ 3. コード検索処理

・collection.query() により質問 embedding と近いチャンクを検索

・n_results=5 で上位5件の関連コード片を取得


■ 4. 文脈統合処理

・検索結果 documents をフラット化して文字列のみ抽出

・複数レイヤ構造に対応し、すべてのチャンクを平坦化

・該当なしの場合は "該当なし" を返す


■ 5. ChatGPT への質問送信

・ナレッジDB（コードチャンク）の内容をプロンプトに挿入

・回答規則として「コードにある事実のみ」、「推測禁止」を指定

・gpt-5-mini-2025-08-07 を使用して回答を生成


■ 6. 対話ループ処理

・ユーザー入力を受け付け "end" または "終了" で終了

・ask_ai() の結果をコンソールへ出力


■ 7. 質問・回答ログ保存

・保存先 指定フォルダ_db.txt を自動作成

・質問と回答を「質問:」「回答:」の形式で追記保存

