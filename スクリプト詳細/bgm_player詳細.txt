<img src="スクリプト画像\BGMプレイヤー画像.png" width="800"
     style="display:block; margin:20px auto;">

■ 1. WAV 再生エンジン（WavPlayer）

・PyAudio を使った手動ストリーミング再生

・別スレッドで再生処理

・再生、停止、一時停止、再開、トグル（play/pause）

・次の曲／前の曲（shuffle対応）

・ループ・シャッフル制御

・シーク再生（指定フレーム位置から読み直し）

・音量調整（16bit/32bit 対応で NumPy によるボリューム適用）

・現在フレーム数・総フレーム数を保持して再生位置と総再生時間を返す

・曲が自然終了したら GUI に通知（on_track_end コールバック）


■ 2. GUI（App）

・CustomTkinter を用いたダークテーマ UI

・ウィンドウタイトル、サイズ、最小サイズ設定

・曲タイトル表示

・リスト表示（Listbox）

・再生・停止・前後・フォルダ選択のボタン

・シークバー（ドラッグ時は再生位置更新を一時停止）

・音量スライダー + パーセント表示

・ステータス表示（再生、停止、シャッフル、ループなど）

・ループ、シャッフルのスイッチ

・自動フォルダ読み込み（起動後 0.5 秒で指定フォルダを自動検索）

・時間表示（「現在秒 / 総秒」）を 0.5 秒間隔で更新

・曲終了時、自動的に次の曲へ移動（on_track_end）


■ 3. 自動フォルダ読み込み

・指定フォルダ（例：D:\OBS_BGM）を起動後に自動スキャン

・WAV ファイルを全て収集し、ソートしてプレイリスト化

・シャッフルONの時は開始曲をランダムに選択

・自動で再生開始する


■ 4. 手動フォルダ選択

・ファイルダイアログで任意フォルダを選択

・WAV を再読み込みし再生開始


■ 5. シーク仕様

・ドラッグ開始で is_seeking フラグを ON

・ドラッグ離し時に該当フレーム位置から再生し直す

・一時停止中でもシークでき、再生位置だけ反映

・シーク中は UI の自動更新が止まり、0.4 秒後に再開


■ 6. 再生時間表示

・再生中は pos / total から進捗を計算しシークバーを更新

・MM:SS 表記で現在位置と総時間を表示

・シーク中は更新を止める

・0.5 秒ごとに update


■ 7. 次／前の曲

・シャッフル ON の場合ランダム選択

・シャッフル OFF の場合は順番で移動

・リスト表示を同期して強制フォーカス

・auto=True の曲終了通知時は自動で次へ移動


■ 8. 安定動作のための工夫

・再生停止時のストリームクローズを2段構えで安全に処理

・スレッド内 try-except 多用で GUI フリーズ防止

・シーク時、再生スレッド終了を待ってから再生し直す

・root.after を使いスレッド安全に GUI 反映


■ 9. ウィンドウ終了時処理

・player.close() で PyAudio を terminate

・app.destroy() で GUI 終了

【内部的な仕様ポイント】


■ 再生は「chunk（8192フレーム）」単位でループ読み

■ NumPy を使って音量調整したデータを stream.write

■ 現在フレーム数 _position_frames を increment して時間表示に利用

■ GUIスレッドと再生スレッドは完全非同期

■ track end 発生時は GUI スレッドへ root.after で通知


■ seek はフレーム単位で管理（秒換算は rate を使用）
